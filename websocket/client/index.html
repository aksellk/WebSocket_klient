<!DOCTYPE HTML>
<html>
<head>

<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css"/>
<link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css"/>
<script src="./jquery-2.2.3.min.js" type="text/javascript"></script>

<script type="text/javascript">

class Board {
  constructor() {

    this.username='';

    //this.ws = new WebSocket("ws://localhost:3001");
    this.ws = new WebSocket("ws://localhost");
    //this.ws = new WebSocket("ws://158.38.211.76:3001");


    this.ws.onerror = function(msg) {
      console.log(msg);
      $("#connection_label").html("Not connected");
    };

    this.ws.onopen = () => {
      $("#connection_label").html("Connected");
    };

    this.ws.onmessage = (event) => {
      var json=JSON.parse(event.data);

      var el = $('#chat');
      el.prepend('<div>' + json.username +': ' + json.message + '</div>');
      el.prepend('<br>');
      el.prepend(json.date);

    };

    this.ws.onclose = function(message) {
      $("#connection_label").html("Not connected");
    };
  }

  sendMessage() {
    var value = document.getElementById("message").value;
    var d = new Date();
    var n = d.toJSON();
    if(value !==""){
      var u = this.username;
      this.ws.send(JSON.stringify({ username: u, message: value, date: n }));
    }
  }




}

var board;
//When this file is fully loaded, initialize board with context
$(document).ready(function(){
  board = new Board($('#board'));

  board.username = prompt('your name:');
  if(board.username.length === 0) return;


});

</script>
</head>
<body>
<div id="connection_label">
Connecting...
</div>

<br>
<div id="input">
   <label>Enter your message to send to the WebSocket server:</label>
   <input class="form-control" type="text" id="message"/>

   <button type="button" id="sendbutton" onclick="board.sendMessage();">Send my message to the server</button>

</div>
<br>
<div id="chat">
</div>
</body>
</html>
